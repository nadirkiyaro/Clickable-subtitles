<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Amharic Subtitles with Phonetics</title>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 800px; margin: auto; }
    #player { margin-bottom: 20px; }
    .subtitle { text-align: center; margin: 20px 0; }
    .amharic { font-size: 26px; font-weight: bold; }
    .phonetic { font-size: 20px; color: #555; margin-top: 5px; }
  </style>
</head>
<body>
  <h1>Learn Amharic with Besintu - Subtitles with Phonetics</h1>
  <div id="player"></div>
  <div id="subtitle" class="subtitle"></div>

  <script src="https://www.youtube.com/iframe_api"></script>
  <script>
    let player;
    let subtitles = [];
    let currentIndex = -1;

    function onYouTubeIframeAPIReady() {
      player = new YT.Player('player', {
        height: '400',
        width: '100%',
        videoId: 'KTZYUfPazdw',
        playerVars: { start: 20, rel: 0 },
        events: { 'onReady': onPlayerReady }
      });
    }

    function onPlayerReady(event) {
      fetch('besintu_ep1_subtitles_full_phonetics.json')
        .then(response => response.json())
        .then(data => {
          subtitles = data;
          setInterval(updateSubtitle, 300);
        });
    }

    function updateSubtitle() {
      if (!player || !subtitles.length) return;
      const time = player.getCurrentTime();
      let nextIndex = -1;
      for (let i = 0; i < subtitles.length; i++) {
        if (time >= subtitles[i].start && time < (subtitles[i + 1]?.start || Infinity)) {
          nextIndex = i;
          break;
        }
      }
      if (nextIndex !== currentIndex) {
        currentIndex = nextIndex;
        displaySubtitle(currentIndex);
      }
    }

    function displaySubtitle(index) {
      const container = document.getElementById('subtitle');
      container.innerHTML = '';
      if (index < 0 || index >= subtitles.length) return;
      const line = subtitles[index];
      container.innerHTML = `
        <div class="amharic">${line.amharic_text}</div>
        <div class="phonetic">${line.phonetic_text}</div>
      `;
    }
  </script>
</body>
</html>
